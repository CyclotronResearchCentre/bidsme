# --------------------------------------------------------------------------------
# This is a bidsmap YAML file with the key-value mappings for the different BIDS
# modalities (anat, func, dwi, etc). The modality attributes are the keys that map
# onto the BIDS labels. The bidsmap data-structure should be 5 levels deep:
# dict > dict > list > dict > dict
#
# NB:
# 1) Edit the bidsmap file to your needs before feeding it to bidscoiner.py
# 2) (Institute) users may create their own bidsmap_[template].yaml or
#    bidsmap_[sample].yaml file
#
# For more information, see:
# https://github.com/Donders-Institute/bidscoin
# https://docs.ansible.com/ansible/latest/reference_appendices/YAMLSyntax.html
# --------------------------------------------------------------------------------


Options:
  version: '2.3.1'
  bidsignore: extra_data/ 


PlugIns:
  path: ~
  options: ~

Templates:
  - &mri_bids_anat !!omap
    # [_ce-<label>][_rec-<label>][_run-<index>]_<modality_label>.nii[.gz]
    # [_ce-<label>][_rec-<label>][_run-<index>][_mod-<label>]_defacemask.nii[.gz]
    - acq: ~
    - ce: ~
    - rec: ~
    - run: <<count>>
    - mod: ~
  - &mri_anat
    provenance: ~
    suffix: ~
    attributes: {}
    bids:
      <<: *mri_bids_anat
    json:
      ContrastBolusIngredient: <ContrastBolusIngredient>

  - &mri_bids_func !!omap
    # [_ce-<label>][_dir-<label>][_rec-<label>][_run-<index>][_echo-<index>]_<contrast_label>.nii[.gz]
    # [_ce-<label>][_dir-<label>][_rec-<label>][_run-<index>][_echo-<index>]_sbref.nii[.gz]
    - task: <SeriesDescription>
    - acq: ~
    - ce: ~
    - dir: ~
    - rec: ~
    - run: <<count>>
    - echo: <EchoNumbers>
  - &mri_func
    provenance: ~
    suffix: BOLD
    attributes: {}
    bids: 
      <<: *mri_bids_func
    json:
      TaskName: <<bids:task>>
      Instructions: ""
      TaskDescription: ""
      CogAtlasID: ""
      CogPOID: ""
      RepetitionTime: <RepetitionTime>
      NumberOfVolumesDiscardedByScanner: ""
      NumberOfVolumesDiscardedByUser: ""
      DelayTime: ""
      DelayAfterTrigger: ""

  - &mri_bids_dwi !!omap
    # [_acq-<label>][_dir-<label>][_run-<index>]_dwi.nii[.gz]
    - acq: ~
    - dir: ~
    - run: <<count>>
  - &mri_dwi
    provenance: ~
    suffix: dwi
    attributes: {}
    bids: 
      <<: *mri_bids_dwi

  - &mri_bids_fmap !!omap
    # Phase difference image and at least one magnitude image
    # [_acq-<label>][_run-<index>]_phasediff.nii[.gz]
    # [_acq-<label>][_run-<index>]_magnitude1.nii[.gz]
    # Two phase images and two magnitude images
    # [_acq-<label>][_run-<index>]_phase1.nii[.gz]
    # [_acq-<label>][_run-<index>]_phase2.nii[.gz]
    # [_acq-<label>][_run-<index>]_magnitude1.nii[.gz]
    # [_acq-<label>][_run-<index>]_magnitude2.nii[.gz]
    - acq: <SeriesDescription>
    - run: <<count>>
  - &mri_fmap_diff
    provenance: ~
    suffix: phasediff
    attributes: {}
    bids: 
      <<: *mri_bids_fmap
    json:
      IntendedFor: 
        - "func/<<subject>>_<<session>>_task-TASK1_bold.nii"
        - "func/<<subject>>_<<session>>_task-TASK2_bold.nii"
      EchoTime1: ""
      EchoTime2: ""
  - &mri_fmap_phase
    provenance: ~
    suffix: phase<EchoNumbers>
    attributes: {}
    bids: 
      <<: *mri_bids_fmap
    json:
      IntendedFor: 
        - "func/<<subject>>_<<session>>_task-TASK1_bold.nii"
        - "func/<<subject>>_<<session>>_task-TASK2_bold.nii"
      EchoTime: <EchoTime>
  - &mri_fmap_magnitude
    provenance: ~
    suffix: magnitude<EchoNumbers>
    attributes: {}
    bids: 
      <<: *mri_bids_fmap
    json:
      IntendedFor: 
        - "func/<<subject>>_<<session>>_task-TASK1_bold.nii"
        - "func/<<subject>>_<<session>>_task-TASK2_bold.nii"
      EchoTime: <EchoTime>
  - &mri_bids_fmap_pepolar !!omap
    # Multiple phase encoded directions ("pepolar")
    # [_acq-<label>][_ce-<label>]_dir-<label>[_run-<index>]_epi.nii[.gz]
    - acq: <SeriesDescription>
    - ce: ~
    - dir: ~
    - run: <<count>>
  - &mri_fmap_pepolar
    provenance: ~
    suffix: epi
    attributes: {}
    bids: 
      <<: *mri_bids_fmap_pepolar
    json:
      IntendedFor:
        - "func/<<subject>>_<<session>>_task-TASK1_bold.nii"
        - "func/<<subject>>_<<session>>_task-TASK2_bold.nii"
      PhaseEncodingDirection: ""
      EchoTime: <EchoTime>


MRI:
  Nifti_dump:
    anat:
    - <<: *mri_anat
      suffix: T1w
      attributes:
        ProtocolName: ['t1.*', '.*mtflash3d_T1w.*'] 
    - <<: *mri_anat
      suffix: FLAIR
      attributes: 
        ProtocolName: 't2_spc_da-fl_sag_p2_iso'
    func:
    - <<: *mri_func
      attributes: 
        ProtocolName: '.*_bold_.*_invertpe'
        ImageType: '.*MOSAIC'
      bids: 
        <<: *mri_bids_func
        dir: PA
    - <<: *mri_func
      attributes: 
        ProtocolName: '.*_bold_.*'
        ImageType: '.*MOSAIC'
      bids: 
        <<: *mri_bids_func
        dir: AP
    dwi:
    - <<: *mri_dwi
      attributes: 
        ProtocolName: '.*_diff_.*_invertpe'
      bids: 
        <<: *mri_bids_dwi
        dir: PA
    - <<: *mri_dwi
      attributes: 
        ProtocolName: '.*_diff_.*'
      bids: 
        <<: *mri_bids_dwi
        dir: AP
    fmap:
    - <<: *mri_fmap_phase
      attributes:
        ProtocolName: 'gre_field_mapping'
        ImageType: 'ORIGINAL\\PRIMARY\\P\\ND'
    - <<: *mri_fmap_magnitude
      attributes:
        ProtocolName: 'gre_field_mapping'
        ImageType: 'ORIGINAL\\PRIMARY\\M\\ND'

    __ignore__:
    - provenance: ~
      suffix: ""
      attributes:
        ProtocolName: 'localizer'
      bids: {}
